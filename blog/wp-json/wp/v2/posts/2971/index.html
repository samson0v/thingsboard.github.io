{"id":2971,"date":"2024-02-29T11:52:07","date_gmt":"2024-02-29T11:52:07","guid":{"rendered":"http:\/\/wp.thingsboard.io\/?p=2971"},"modified":"2024-06-20T13:34:09","modified_gmt":"2024-06-20T13:34:09","slug":"optimizing-dashboard-performance-with-enhanced-image-management","status":"publish","type":"post","link":"https:\/\/tbblog.xyz\/optimizing-dashboard-performance-with-enhanced-image-management\/","title":{"rendered":"Optimizing dashboard performance with enhanced image management"},"content":{"rendered":"\n<p style=\"font-size:16px\">At ThingsBoard, we&#8217;ve always been committed to enhancing user experience and system performance. Our latest update, version <a href=\"https:\/\/thingsboard.io\/docs\/reference\/releases\/#v362\">3.6.2<\/a>, introduces significant improvements in how images are managed within dashboards, widgets, and more. This update is a key enhancement designed to tackle inefficiencies identified as our user base expanded.<\/p>\n\n\n\n<h4 class=\"wp-block-heading\">The challenge with large images<\/h4>\n\n\n\n<p style=\"font-size:16px\">Since the earliest releases, our platform has permitted the embedding of images in dashboards and widgets via external links or Base64 encoded data URLs. While flexible, this approach presented a significant challenge. Users occasionally embedded images up to 50MB in size directly into dashboards. Editing or exporting these dashboards meant transferring massive JSON files to and from the server, a highly inefficient process. This not only affected loading times but also the responsiveness of the dashboard editing experience.<\/p>\n\n\n\n<h4 class=\"wp-block-heading\">The solution<\/h4>\n\n\n\n<p style=\"font-size:16px\">To address this issue, we&#8217;ve introduced a major update in how images are handled within the platform. A central aspect of this update is the introduction of the <a href=\"https:\/\/thingsboard.io\/docs\/user-guide\/image-gallery\/\">Image Gallery<\/a>. By moving dashboards to a separate entity and utilizing our internal, relative links for storing image references, we&#8217;ve significantly improved efficiency. This change minimizes the size of dashboard JSON files, streamlining both loading and editing processes. The Image Gallery simplifies the process of uploading, organizing, and selecting images.<\/p>\n\n\n\n<figure class=\"wp-block-gallery has-nested-images columns-default is-cropped wp-block-gallery-6 is-layout-flex wp-block-gallery-is-layout-flex\">\n<figure class=\"wp-block-image size-full\"><img fetchpriority=\"high\" decoding=\"async\" width=\"2409\" height=\"1353\" data-id=\"4505\" src=\"https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery.webp\" alt=\"\" class=\"wp-image-4505\" srcset=\"https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery.webp 2409w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery-300x168.webp 300w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery-1024x575.webp 1024w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery-768x431.webp 768w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery-1536x863.webp 1536w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery-2048x1150.webp 2048w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery-512x288.webp 512w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery-920x517.webp 920w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery-1600x899.webp 1600w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/image-gallery-1920x1078.webp 1920w\" sizes=\"(max-width: 2409px) 100vw, 2409px\" \/><\/figure>\n<\/figure>\n\n\n\n<h4 class=\"wp-block-heading\">Backward compatibility<\/h4>\n\n\n\n<p style=\"font-size:16px\">The platform&#8217;s upgrade script automatically converts all existing dashboards to the new format. Users can still upload dashboards in the old format to a new platform instance. These dashboards will automatically be converted to the new format during the upload process.<\/p>\n\n\n\n<p style=\"font-size:16px\">For example, consider a \u201cSensors\u201d dashboard with its background image stored in the old format:<\/p>\n\n\n\n<pre class=\"wp-block-code has-black-color has-text-color has-link-color wp-elements-240688aa6d231c0cb4116ec18afee3f6\"><code lang=\"\" class=\"\">{\n...\n\"backgroundImageUrl\": \"data:image\/webp;base64,iVBORw...JRU5ErkJggg==\"\n...\n}<\/code><\/pre>\n\n\n\n<p style=\"font-size:16px\">After the upgrade, a new image will be created in the image gallery:<\/p>\n\n\n\n<figure class=\"wp-block-gallery has-nested-images columns-default is-cropped wp-block-gallery-7 is-layout-flex wp-block-gallery-is-layout-flex\">\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" width=\"2409\" height=\"1353\" data-id=\"4508\" src=\"https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1.webp\" alt=\"\" class=\"wp-image-4508\" srcset=\"https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1.webp 2409w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1-300x168.webp 300w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1-1024x575.webp 1024w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1-768x431.webp 768w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1-1536x863.webp 1536w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1-2048x1150.webp 2048w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1-512x288.webp 512w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1-920x517.webp 920w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1-1600x899.webp 1600w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Edit-image-1-1920x1078.webp 1920w\" sizes=\"(max-width: 2409px) 100vw, 2409px\" \/><\/figure>\n<\/figure>\n\n\n\n<p style=\"font-size:16px\">The image name is auto-generated based on the dashboard name and the dashboard element where the image is used. This same behavior applies to images used in widget configuration: markers, backgrounds, etc. The dashboard now references the image using the following link:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code lang=\"json\" class=\"language-json\">{\n...\n\"backgroundImageUrl\": \"\/api\/images\/tenant\/sensors_dashboard_default_background.webp\"\n...\n}<\/code><\/pre>\n\n\n\n<h4 class=\"wp-block-heading\">Private and public image links<\/h4>\n\n\n\n<p style=\"font-size:16px\">Images can be provisioned at the system and tenant levels. System-level widgets are accessible to all platform users, while tenant images are available to authorized users of specific tenants.<\/p>\n\n\n\n<p style=\"font-size:16px\">To embed an image into an Angular HTML template, such as the Markdown widget, HTML section in the widget editor, custom actions, etc., use the following code snippet:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code class=\"\">&lt;img [src]=\"'\/api\/images\/tenant\/sensors_dashboard_default_background.webp' | image | async\" \/&gt;<\/code><\/pre>\n\n\n\n<p style=\"font-size:16px\">The <code>image<\/code> pipe automatically adds the necessary authentication headers to the image request, allowing the same relative image URL to return different content for users from different tenants.<\/p>\n\n\n\n<p style=\"font-size:16px\">However, custom widgets or static HTML blocks that do not support Angular HTML syntax cannot add authentication headers to requests. Therefore, every platform image also has a unique URL for downloading the image without authentication. Using the following code snippet, you may embed an image into the components based on the plain HTML. Such components include HTML card widgets, cell content functions, etc.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code class=\"\">&lt;img src=\"\/api\/images\/public\/ZA4biARtpnl970l0j8MMolRKM56fbpK1\" alt=\"&amp;quot;Sensors&amp;quot; dashboard default background\" \/&gt;<\/code><\/pre>\n\n\n\n<p style=\"font-size:16px\">Each code snippet is unique to its image, and you can find the corresponding snippets in the Embed image window.<\/p>\n\n\n\n<figure class=\"wp-block-gallery has-nested-images columns-default is-cropped wp-block-gallery-8 is-layout-flex wp-block-gallery-is-layout-flex\">\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" width=\"2409\" height=\"1446\" data-id=\"4510\" src=\"https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1.webp\" alt=\"\" class=\"wp-image-4510\" srcset=\"https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1.webp 2409w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1-300x180.webp 300w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1-1024x615.webp 1024w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1-768x461.webp 768w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1-1536x922.webp 1536w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1-2048x1229.webp 2048w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1-512x307.webp 512w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1-920x552.webp 920w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1-1600x960.webp 1600w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/Embed-image-1-1920x1152.webp 1920w\" sizes=\"(max-width: 2409px) 100vw, 2409px\" \/><\/figure>\n<\/figure>\n\n\n\n<h4 class=\"wp-block-heading\">Caching<\/h4>\n\n\n\n<p style=\"font-size:16px\">Our image API now utilizes ETags to optimize caching, ensuring that images are only re-downloaded when they have changed. This approach significantly saves bandwidth and improves load times. While we don&#8217;t apply Cache-Control headers by default, users have the flexibility to customize caching behavior through environment variables, including settings for image ETags cache TTL, maximum cache size, and browser cache TTL for both system and tenant images. These settings are crucial for balancing between reducing server load and ensuring content freshness.<\/p>\n\n\n\n<figure class=\"wp-block-gallery has-nested-images columns-default is-cropped wp-block-gallery-9 is-layout-flex wp-block-gallery-is-layout-flex\">\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"2409\" height=\"1353\" data-id=\"4511\" src=\"https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3.webp\" alt=\"\" class=\"wp-image-4511\" srcset=\"https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3.webp 2409w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3-300x168.webp 300w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3-1024x575.webp 1024w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3-768x431.webp 768w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3-1536x863.webp 1536w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3-2048x1150.webp 2048w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3-512x288.webp 512w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3-920x517.webp 920w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3-1600x899.webp 1600w, https:\/\/tbblog.xyz\/wp-content\/uploads\/2024\/05\/scheme3-1920x1078.webp 1920w\" sizes=\"(max-width: 2409px) 100vw, 2409px\" \/><\/figure>\n<\/figure>\n\n\n\n<p style=\"font-size:16px\">The platform offers environment variables to control caching behavior:<\/p>\n\n\n\n<ul>\n<li style=\"font-size:16px\">CACHE_SPECS_IMAGE_ETAGS_TTL<strong>:<\/strong> Controls the cache TTL for image ETags. The default is set to 44640 minutes (31 days), after which the cache is cleared.<br><\/li>\n\n\n\n<li style=\"font-size:16px\">CACHE_SPECS_IMAGE_ETAGS_MAX_SIZE<strong>:<\/strong> Determines the maximum ETags cache size on the server. The default is 10000. Setting this to 0 disables the cache. <br><\/li>\n\n\n\n<li style=\"font-size:16px\">CACHE_SPECS_IMAGE_SYSTEM_BROWSER_TTL and CACHE_SPECS_IMAGE_TENANT_BROWSER_TTL<strong>:<\/strong> These settings manage the browser cache TTL for system and tenant images, respectively, with a default of 0 minutes, meaning caching is disabled by default.<\/li>\n<\/ul>\n\n\n\n<p style=\"font-size:16px\">These settings allow administrators to adjust the balance between performance and content freshness as needed.<\/p>\n\n\n\n<h4 class=\"wp-block-heading\">Improvement Summary<\/h4>\n\n\n\n<p style=\"font-size:16px\">By tackling the challenge of image management within dashboards, we aim to offer a more efficient, robust, and user-friendly platform. Following the upgrade of <a href=\"https:\/\/thingsboard.cloud\">thingsboard.cloud<\/a>, we&#8217;ve observed an 86% reduction in the size of the dashboards, and some dashboards now load more than twice as fast.<\/p>\n","protected":false},"excerpt":{"rendered":"At ThingsBoard, we&#8217;ve always been committed to enhancing user experience and system performance. Our latest update, version 3.6.2,&hellip;","protected":false},"author":4,"featured_media":4059,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_monsterinsights_skip_tracking":false,"_monsterinsights_sitenote_active":false,"_monsterinsights_sitenote_note":"","_monsterinsights_sitenote_category":0,"footnotes":"","csco_display_header_overlay":false,"csco_singular_sidebar":"","csco_page_header_type":""},"categories":[140],"tags":[],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/posts\/2971"}],"collection":[{"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/users\/4"}],"replies":[{"embeddable":true,"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/comments?post=2971"}],"version-history":[{"count":27,"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/posts\/2971\/revisions"}],"predecessor-version":[{"id":4699,"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/posts\/2971\/revisions\/4699"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/media\/4059"}],"wp:attachment":[{"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/media?parent=2971"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/categories?post=2971"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/tbblog.xyz\/wp-json\/wp\/v2\/tags?post=2971"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}